---
title: eosvoter | 架构 v1
date: 2020-02-29 11:08:43
categories:
- eosvoter
tags:
- eosvoter
---
这个是项目的框架设计，我将从一下三个方面进行诉说。

- mvc 设计
- 前后端分离
- docker 部署

<!-- more -->

<br/>

# 写在前面

<br/>

本项目的后端语言是 python,版本是 3.7 ，所使用的框架是 flask。

前端使用的框架是 vue。

主项目在物理机上，数据抓取在 docker 虚拟机上。

<br/>

# mvc 设计

<br/>

整个项目是以 mvc 以主导的，关于什么是 mvc，建议你看一下我下面的博文。

[MVC设计思想](https://benpaodewoniu.github.io/2019/10/06/designthinkings0/)

{% img /images/eos_voter/7_0.png %}

下面我想详细介绍一下各个文件夹的作用。

## api

这个文件夹里面存放着对部分网页数据的解析。因为，项目需要，所以，需要获得链上数据，就类似于爬虫爬取网页，然后解析出相应的数据，这个目录里面的文件就是这个作用。

## docker

这个文件夹里面存放着docker部署相关的文件，包括，开启，结束，进入等。

## models

这个文件夹里面存放着和数据库直接相关的文件，也就是直接对数据库进行增删改查。

{% img /images/eos_voter/7_1.png %}

里面每一个文件都是映射了项目的一个大类，比如结算、投票、账号。

具体再分的话，就是 vote.py 对应 t_vote 和 t_vote_statistics 这两张表，其他也相应对应其他的表。

这样做的好处就是，将表看成一个对象，然后，我们将对这个对象的相关操作放在一个文件中，减小耦合，也增加内聚，避免写多余的代码。

不过，单单以这个项目来说， models 里面的文件，并不是一个文件对应一个数据表，而是同一大类的数据表对应一个文件。

这么做的原因主要是，这个项目算是一个中小型项目，如果每一张表对应一个文件，很显得很杂。并且，这个项目的功能很独立，划功能很好区分。

## monitor

这个是监控层，主要是防止代码运行中出现 bug ，导致部分数据抓不到，保证了数据的稳定性。

我们的机器人是以叮叮为主的。

## service

{% img /images/eos_voter/7_2.png %}

这个处理层，是介于 mian.py 和 models 之间的层。当，请求发到 main.py ，mian.py将请求转发到 service 对应的文件中，然后，service 对这个请求做分析，然后，根据结果，去调用 models 的处理函数。

这样做的好处是符合 mvc 的设计规则的。

## util

这个文件夹存放着一些工具文件，比如时间的修改，文件路径的获取等。

## 可执行脚本

在这个项目中，具有可以执行的脚本，其地位和 main.py 一样，都是放在主目录下面的。可执行脚本包括数据采集，数据修复等。

## main.py

项目的入口文件。

里面只接受请求，然后转发请求，不对请求做任何处理。

## 服务脚本

用于开始项目，在线上部署项目

关于对这个项目的 mvc 的分析，我在下面的博文，我的思考中给出，只不过当时，经验不足，没有更好的给出，比如，我当时并不理解什么是前后端分离。

但是，其，基本的意思也差不多表达出来，所以，在这里不再重复说明。

[MVC设计思想](https://benpaodewoniu.github.io/2019/10/06/designthinkings0/)

<br/>

# 前后端分离

<br/>

最初做这个项目之前，我在大二的时候，在创业公司做过一个电商项目，其是前后端结合，也就是前后端放在一个项目中。

但是，这个项目采用的是前后端完全分离，即前端和后端完全是两个项目。当接口数据结构规范好之后，我们就能自行完成任务了。

## 对于合作来说

1. 前端不必再根据后端的工作进度而让自己没任务可以干，因为，自己可以伪造数据，进行页面修改
2. 双方可以自行部署自己的项目，而不需要等其他项目组
3. 更加高效的协同合作

## 数据展示

所谓的前后端分离，是这样的流程，后端暴露出一个端口，比如

	127.0.0.1:5000/get_data

而，前端加载页面的时候，就这样访问这个 url ，就会获得数据。

所以，整个流程是，后端的采集数据模块，将数据加载到数据库本地，然后，给予相关的接口信息，前端通过访问这些接口，拿到数据，进行展示。

<br/>

# docker部署

<br/>

这个有点微服务的意思。

事实上，我们的项目一共有两大块，一块是数据采集，一块是数据展现。

通过名字，你就能知道这两块的功能是相互独立的，数据采集将数据放在数据库中，数据展现是从数据库读数据。

所以，我们在物理机上部署数据展现，然后启动一个 docker 来部署数据采集。

这样做的好处，我认为是

1. 可以更有效的使用计算机资源，如果，你同时部署一个功能，这个功能包含采集和展示，那么就相当于是两个人使用一个工具干两个活，而如果分别部署，由于并行和多核的存在，就会变成两个人使用两个工具干两个活，自然也能提高效率。
2. 让系统变的更加稳定，而且 docker 好部署好迁移。
3. 到后期，可以通过 docker 来缓解服务器压力，比如，如果有一个接口经常使用，并且，cpu 使用率特别高，那么，我们就可以专门部署一个 docker 来部署这个接口的服务。

总之，daokcer 的好处太多了。




